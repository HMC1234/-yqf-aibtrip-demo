# Supabase é…ç½®ç¡®è®¤

## âœ… å·²ç¡®è®¤çš„é…ç½®ä¿¡æ¯

- **Project URL**: https://ienbmjucvvvdwfwcpejy.supabase.co
- **Project Name**: YQFAIBTRIP
- **Project ID**: ienbmjucvvvdwfwcpejy
- **Anon Key**: âœ… å·²æä¾›
- **Service Role Key**: âœ… å·²æä¾›

---

## ğŸš€ æ‰§è¡Œæ•°æ®åº“è¿ç§»

ç°åœ¨æˆ‘å°†ä¸ºæ‚¨æ‰§è¡Œæ•°æ®åº“è¿ç§»è„šæœ¬ã€‚è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

### æ–¹å¼1ï¼šé€šè¿‡Supabase Dashboardæ‰§è¡Œï¼ˆæ¨èï¼Œæœ€ç®€å•ï¼‰

1. **è®¿é—®Supabase Dashboard**
   - æ‰“å¼€ï¼šhttps://supabase.com/dashboard
   - ç™»å½•æ‚¨çš„è´¦æˆ·
   - é€‰æ‹©é¡¹ç›®ï¼šYQFAIBTRIP

2. **æ‰“å¼€SQL Editor**
   - åœ¨å·¦ä¾§èœå•ç‚¹å‡» "SQL Editor"
   - ç‚¹å‡»å³ä¸Šè§’ "New query" æŒ‰é’®

3. **æ‰§è¡Œè¿ç§»è„šæœ¬**
   - æ‰“å¼€é¡¹ç›®ä¸­çš„ `database_migration.sql` æ–‡ä»¶
   - å¤åˆ¶å…¨éƒ¨å†…å®¹ï¼ˆCtrl+A, Ctrl+Cï¼‰
   - ç²˜è´´åˆ°SQL Editorä¸­ï¼ˆCtrl+Vï¼‰
   - ç‚¹å‡»å³ä¸‹è§’ "Run" æŒ‰é’®æˆ–æŒ‰ Ctrl+Enter

4. **æŸ¥çœ‹æ‰§è¡Œç»“æœ**
   - å¦‚æœæˆåŠŸï¼Œä¼šæ˜¾ç¤º "Success. No rows returned"
   - å¦‚æœæœ‰é”™è¯¯ï¼Œä¼šæ˜¾ç¤ºå…·ä½“çš„é”™è¯¯ä¿¡æ¯

### æ–¹å¼2ï¼šåˆ†æ­¥æ‰§è¡Œï¼ˆå¦‚æœé‡åˆ°é—®é¢˜ï¼‰

å¦‚æœä¸€æ¬¡æ€§æ‰§è¡Œæ•´ä¸ªè„šæœ¬é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥åˆ†æ­¥æ‰§è¡Œï¼š

#### æ­¥éª¤1ï¼šå¯ç”¨æ‰©å±•
```sql
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
```

#### æ­¥éª¤2ï¼šåˆ›å»ºè¡¨ï¼ˆæŒ‰é¡ºåºæ‰§è¡Œï¼‰
å…ˆæ‰§è¡Œç”¨æˆ·ç›¸å…³è¡¨ï¼Œå†æ‰§è¡Œä¸šåŠ¡è¡¨ï¼Œæœ€åæ‰§è¡ŒAIç›¸å…³è¡¨ã€‚

#### æ­¥éª¤3ï¼šåˆ›å»ºå‡½æ•°å’Œè§¦å‘å™¨
æ‰§è¡Œå‡½æ•°å’Œè§¦å‘å™¨éƒ¨åˆ†ã€‚

#### æ­¥éª¤4ï¼šå¯ç”¨RLSå’Œåˆ›å»ºç­–ç•¥
æ‰§è¡ŒRLSç›¸å…³éƒ¨åˆ†ã€‚

#### æ­¥éª¤5ï¼šæ’å…¥åˆå§‹åŒ–æ•°æ®
æ‰§è¡Œåˆå§‹åŒ–æ•°æ®éƒ¨åˆ†ã€‚

---

## âœ… æ‰§è¡ŒåéªŒè¯æ¸…å•

æ‰§è¡Œå®Œæˆåï¼Œè¯·éªŒè¯ä»¥ä¸‹å†…å®¹ï¼š

### 1. æ£€æŸ¥è¡¨ï¼ˆ14å¼ è¡¨ï¼‰

åœ¨ "Table Editor" ä¸­åº”è¯¥èƒ½çœ‹åˆ°ï¼š

**ç”¨æˆ·ç›¸å…³ï¼ˆ4å¼ ï¼‰**ï¼š
- [ ] companies
- [ ] departments
- [ ] cost_centers
- [ ] users

**ä¸šåŠ¡ç›¸å…³ï¼ˆ5å¼ ï¼‰**ï¼š
- [ ] travel_requests
- [ ] approval_records
- [ ] orders
- [ ] search_records
- [ ] travel_policies

**AIç›¸å…³ï¼ˆ4å¼ ï¼‰**ï¼š
- [ ] ai_recommendations
- [ ] recommendation_details
- [ ] chat_messages
- [ ] keywords

**ç³»ç»Ÿç›¸å…³ï¼ˆ1å¼ ï¼‰**ï¼š
- [ ] sequence_numbers

### 2. æ£€æŸ¥å‡½æ•°ï¼ˆ4ä¸ªå‡½æ•°ï¼‰

åœ¨ "Database" > "Functions" ä¸­åº”è¯¥èƒ½çœ‹åˆ°ï¼š
- [ ] update_updated_at_column()
- [ ] generate_travel_request_no()
- [ ] generate_order_no()
- [ ] generate_recommendation_no()

### 3. æ£€æŸ¥åˆå§‹åŒ–æ•°æ®

åœ¨ "Table Editor" ä¸­æ£€æŸ¥ï¼š

**companiesè¡¨**ï¼š
- [ ] åº”è¯¥æœ‰1æ¡è®°å½•ï¼šæµ‹è¯•å…¬å¸ï¼ˆTEST001ï¼‰

**departmentsè¡¨**ï¼š
- [ ] åº”è¯¥æœ‰1æ¡è®°å½•ï¼šæŠ€æœ¯éƒ¨ï¼ˆTECH001ï¼‰

**cost_centersè¡¨**ï¼š
- [ ] åº”è¯¥æœ‰1æ¡è®°å½•ï¼šæŠ€æœ¯æˆæœ¬ä¸­å¿ƒï¼ˆCC001ï¼‰

**keywordsè¡¨**ï¼š
- [ ] åº”è¯¥æœ‰26æ¡è®°å½•ï¼ˆ10ä¸ªæœºç¥¨å…³é”®å­— + 10ä¸ªé…’åº—å…³é”®å­— + 6ä¸ªç«è½¦ç¥¨å…³é”®å­— + 5ä¸ªç”¨è½¦å…³é”®å­—ï¼‰

---

## ğŸ”§ åˆ›å»ºæµ‹è¯•ç”¨æˆ·

æ‰§è¡Œå®Œè¿ç§»è„šæœ¬åï¼Œéœ€è¦åˆ›å»ºæµ‹è¯•ç”¨æˆ·ï¼š

### æ­¥éª¤1ï¼šåœ¨Supabase Authä¸­åˆ›å»ºç”¨æˆ·

1. æ‰“å¼€ "Authentication" > "Users"
2. ç‚¹å‡» "Add user" > "Create new user"
3. å¡«å†™ä¿¡æ¯ï¼š
   - Email: `test@example.com`ï¼ˆæˆ–æ‚¨æŒ‡å®šçš„é‚®ç®±ï¼‰
   - Password: `123456`
   - Auto Confirm User: âœ… å‹¾é€‰
4. ç‚¹å‡» "Create user"
5. **é‡è¦**ï¼šå¤åˆ¶åˆ›å»ºçš„ç”¨æˆ·IDï¼ˆUUIDæ ¼å¼ï¼‰

### æ­¥éª¤2ï¼šåœ¨usersè¡¨ä¸­æ’å…¥ç”¨æˆ·ä¿¡æ¯

åœ¨SQL Editorä¸­æ‰§è¡Œï¼š

```sql
INSERT INTO users (
    id,
    email,
    username,
    full_name,
    company_id,
    department_id,
    cost_center_id,
    role
) VALUES (
    '[è¿™é‡Œç²˜è´´ä»Authä¸­å¤åˆ¶çš„ç”¨æˆ·ID]',
    'test@example.com',
    'test',
    'æµ‹è¯•ç”¨æˆ·',
    '00000000-0000-0000-0000-000000000001',
    '00000000-0000-0000-0000-000000000002',
    '00000000-0000-0000-0000-000000000003',
    'employee'
);
```

---

## ğŸ§ª æµ‹è¯•å•å·ç”Ÿæˆå‡½æ•°

æ‰§è¡Œä»¥ä¸‹SQLæµ‹è¯•å‡½æ•°æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š

```sql
-- æµ‹è¯•ç”Ÿæˆå‡ºå·®ç”³è¯·å•å·
SELECT generate_travel_request_no('JD');
SELECT generate_travel_request_no('AI');

-- æµ‹è¯•ç”Ÿæˆé¢„è®¢å•å·
SELECT generate_order_no('classic');
SELECT generate_order_no('ai_recommendation');

-- æµ‹è¯•ç”ŸæˆAIæ¨èå•å·
SELECT generate_recommendation_no('ZDT');
SELECT generate_recommendation_no('GXH');
SELECT generate_recommendation_no('AIC');
SELECT generate_recommendation_no('GXC');
```

æ¯ä¸ªå‡½æ•°åº”è¯¥è¿”å›ä¸€ä¸ªæ ¼å¼æ­£ç¡®çš„å•å·ï¼Œä¾‹å¦‚ï¼š
- `BTRQ+JD+20241219143025+0001`
- `BK+TR+20241219143025+00001`
- `AIRD+ZDT+20241219143025+00001`

---

## ğŸ“ æ‰§è¡Œè®°å½•

è¯·åœ¨æ‰§è¡Œåè®°å½•ï¼š

- [ ] è¿ç§»è„šæœ¬æ‰§è¡Œæ—¶é—´ï¼š___________
- [ ] æ˜¯å¦æœ‰é”™è¯¯ï¼šæ˜¯ / å¦
- [ ] é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰ï¼š___________
- [ ] æµ‹è¯•ç”¨æˆ·åˆ›å»ºæ—¶é—´ï¼š___________
- [ ] æµ‹è¯•ç”¨æˆ·IDï¼š___________

---

## ğŸ†˜ å¦‚æœé‡åˆ°é—®é¢˜

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ³•

1. **"relation already exists"**
   - è¯´æ˜è¡¨å·²å­˜åœ¨ï¼Œå¯ä»¥åˆ é™¤åé‡æ–°æ‰§è¡Œï¼Œæˆ–ä½¿ç”¨ `DROP TABLE IF EXISTS` å…ˆåˆ é™¤

2. **"function already exists"**
   - è„šæœ¬ä¸­å·²ä½¿ç”¨ `CREATE OR REPLACE FUNCTION`ï¼Œåº”è¯¥ä¼šè‡ªåŠ¨æ›¿æ¢

3. **"permission denied"**
   - ç¡®ä¿ä½¿ç”¨Service Role Keyæˆ–å…·æœ‰è¶³å¤Ÿæƒé™çš„è´¦æˆ·

4. **å¤–é”®çº¦æŸé”™è¯¯**
   - æ£€æŸ¥è¡¨åˆ›å»ºé¡ºåºæ˜¯å¦æ­£ç¡®
   - ç¡®ä¿ä¾èµ–çš„è¡¨å·²å…ˆåˆ›å»º

---

**çŠ¶æ€**ï¼šå‡†å¤‡æ‰§è¡Œ  
**åˆ›å»ºæ—¥æœŸ**ï¼š2024-12-19

