# 🎯 经典预订搜索字段优化总结

**优化日期**：2024-12-19  
**优化内容**：参考携程网，优化酒店和用车搜索字段，添加默认城市选项

---

## 📋 优化内容

### 1. 添加默认城市列表 ✅

**新增城市列表**（20个常见城市）：
- 北京、上海、广州、深圳、杭州、成都、重庆、西安、南京、武汉
- 天津、苏州、长沙、郑州、青岛、大连、厦门、昆明、三亚、哈尔滨

**实现方式**：
```typescript
const COMMON_CITIES = [
  { label: '北京', value: '北京' },
  { label: '上海', value: '上海' },
  // ... 更多城市
]
```

---

### 2. 机票搜索字段优化 ✅

**优化前**：
- ❌ 出发地和目的地使用文本输入框

**优化后**：
- ✅ 出发地和目的地使用下拉选择框（支持搜索）
- ✅ 城市列表包含20个常见城市
- ✅ 支持输入搜索过滤城市

**字段列表**：
1. **出发地**（必填，下拉选择）
2. **目的地**（必填，下拉选择）
3. **出发日期和回程日期**（必填，日期范围选择器）
4. **人数**（必填，1-9人）
5. **舱位等级**（可选，经济舱/商务舱/头等舱）

---

### 3. 酒店搜索字段优化 ✅

**优化前**：
- ❌ 使用出发地和目的地字段
- ❌ 仅酒店星级选项
- ❌ 房间数和人数混淆

**优化后**（参考携程网）：
- ✅ 使用"入住城市"字段（下拉选择）
- ✅ 区分"房间数"和"入住人数"
- ✅ 增加"位置偏好"选项（市中心、机场附近等）
- ✅ 增加"价格区间"选项（按每晚价格）
- ✅ 优化酒店星级选项（包含"不限"选项）

**字段列表**：
1. **入住城市**（必填，下拉选择，支持搜索）
2. **入住日期和退房日期**（必填，日期范围选择器）
3. **房间数**（必填，1-10间）
4. **入住人数**（必填，1-6人）
5. **酒店星级**（可选，不限/五星级/四星级/三星级/二星级）
6. **位置偏好**（可选，不限/市中心/机场附近/火车站附近/商务区/景区附近）
7. **价格区间（元/晚）**（可选，不限/￥0-300/￥300-500/￥500-800/￥800-1200/￥1200以上）

---

### 4. 用车搜索字段优化 ✅

**优化前**：
- ❌ 仅用车日期
- ❌ 缺少出发地点和目的地
- ❌ 缺少车型选择
- ❌ 缺少服务类型选择

**优化后**（参考携程网）：
- ✅ 使用"用车城市"字段（下拉选择）
- ✅ 增加"用车时间"选择
- ✅ 增加"出发地点"和"目的地"输入框
- ✅ 增加"车型选择"（经济型、舒适型、商务型、豪华型、SUV、MPV）
- ✅ 增加"服务类型"（带司机/自驾）
- ✅ 增加"预计用车时长"选择（1-24小时）

**字段列表**：
1. **用车城市**（必填，下拉选择，支持搜索）
2. **用车日期**（必填，日期选择器）
3. **用车时间**（必填，08:00-20:00）
4. **出发地点**（必填，文本输入）
5. **目的地**（必填，文本输入）
6. **车型选择**（必填，经济型/舒适型/商务型/豪华型/SUV/MPV）
7. **服务类型**（必填，带司机/自驾）
8. **预计用车时长（小时）**（必填，1-24小时）

---

### 5. 火车票搜索字段优化 ✅

**保持不变**（已符合使用习惯）：
- ✅ 出发地（下拉选择，支持搜索）
- ✅ 目的地（下拉选择，支持搜索）
- ✅ 出发日期（日期选择器）
- ✅ 人数（1-9人）

---

## 🔧 技术实现

### 1. 城市下拉选择组件

**特点**：
- 支持搜索过滤
- 支持键盘输入
- 美观易用

**实现**：
```typescript
<Select
  size="large"
  placeholder="请选择城市"
  showSearch
  filterOption={(input, option) =>
    (option?.label ?? '').toLowerCase().includes(input.toLowerCase())
  }
  options={COMMON_CITIES}
/>
```

---

### 2. 产品类型切换逻辑

**实现**：
- 切换产品类型时，自动清除相关字段
- 酒店/用车使用`city`字段
- 机票/火车票使用`origin`和`destination`字段

**代码**：
```typescript
onChange={(e) => {
  const newType = e.target.value
  setProductType(newType)
  // 切换产品类型时，清除相关字段
  if (newType === 'hotel' || newType === 'car') {
    form.setFieldsValue({
      origin: undefined,
      destination: undefined,
    })
  } else {
    form.setFieldsValue({
      city: undefined,
    })
  }
}}
```

---

### 3. 搜索记录数据结构优化

**优化前**：
```typescript
const searchRecord = {
  origin: values.origin,
  destination: values.destination,
  // ... 其他字段
}
```

**优化后**：
```typescript
// 根据产品类型构建不同的搜索记录
if (productType === 'hotel') {
  searchRecord.origin = values.city // 使用city作为origin
  searchRecord.destination = values.city
  searchRecord.search_params = {
    room_count: values.room_count,
    guest_count: values.guest_count,
    hotel_star: values.hotel_star,
    location_preference: values.location_preference,
    price_range: values.price_range,
  }
} else if (productType === 'car') {
  searchRecord.search_params = {
    city: values.city,
    car_time: values.car_time,
    car_type: values.car_type,
    service_type: values.service_type,
    duration: values.duration,
  }
}
```

---

### 4. 产品列表Mock数据优化

**酒店Mock数据优化**：
- ✅ 支持动态城市名称
- ✅ 增加更多酒店选项（4个）
- ✅ 区分不同位置类型（市中心、商务区、机场附近、火车站附近）
- ✅ 增加价格区间和评分

**用车Mock数据优化**：
- ✅ 支持动态城市名称
- ✅ 根据服务类型（带司机/自驾）计算价格
- ✅ 根据用车时长计算总价
- ✅ 增加更多车型选项（4个）
- ✅ 显示详细的服务信息

---

## 📋 修改的文件

### 1. `src/pages/Booking/ClassicBooking.tsx`

**主要修改**：
- ✅ 添加`COMMON_CITIES`城市列表常量
- ✅ 机票/火车票：出发地和目的地改为下拉选择
- ✅ 酒店：使用"入住城市"字段，增加房间数、入住人数、位置偏好、价格区间
- ✅ 用车：使用"用车城市"字段，增加用车时间、出发地点、目的地、车型选择、服务类型、预计时长
- ✅ 优化产品类型切换逻辑
- ✅ 优化搜索记录数据结构
- ✅ 优化从申请单跳转时的字段填充逻辑

---

### 2. `src/pages/Booking/ProductList.tsx`

**主要修改**：
- ✅ 优化酒店Mock数据生成（支持动态城市，增加选项）
- ✅ 优化用车Mock数据生成（支持动态城市，根据服务类型和时长计算价格）

---

## ✅ 优化效果

### 1. 用户体验提升

**机票搜索**：
- ✅ 城市选择更方便（下拉选择而非手动输入）
- ✅ 减少输入错误（预定义城市列表）
- ✅ 支持快速搜索城市

**酒店搜索**：
- ✅ 字段更符合使用习惯（参考携程网）
- ✅ 选项更丰富（位置偏好、价格区间）
- ✅ 区分房间数和入住人数（更准确）

**用车搜索**：
- ✅ 字段更完整（车型、服务类型、时长）
- ✅ 更符合实际使用场景
- ✅ 价格计算更合理（根据服务类型和时长）

---

### 2. 数据准确性提升

**优化前**：
- ❌ 城市名称可能不统一（手动输入）
- ❌ 酒店搜索缺少关键信息（位置、价格）
- ❌ 用车搜索信息不完整

**优化后**：
- ✅ 城市名称统一（下拉选择）
- ✅ 酒店搜索包含完整信息
- ✅ 用车搜索信息完整准确

---

## 🧪 测试建议

### 1. 机票搜索测试

1. **测试城市选择**
   - 测试下拉选择是否正常
   - 测试搜索过滤是否正常
   - 测试键盘输入是否正常

2. **测试表单提交**
   - 测试必填字段验证
   - 测试日期选择
   - 测试人数选择

---

### 2. 酒店搜索测试

1. **测试字段显示**
   - 切换到酒店类型，验证字段是否正确显示
   - 验证"入住城市"是否显示
   - 验证"房间数"和"入住人数"是否区分

2. **测试可选字段**
   - 测试酒店星级选择（包含"不限"）
   - 测试位置偏好选择
   - 测试价格区间选择

3. **测试表单提交**
   - 测试必填字段验证
   - 测试日期范围选择
   - 验证搜索参数是否正确传递

---

### 3. 用车搜索测试

1. **测试字段显示**
   - 切换到用车类型，验证字段是否正确显示
   - 验证所有字段是否完整（城市、日期、时间、出发地、目的地、车型、服务类型、时长）

2. **测试车型和服务类型**
   - 测试不同车型选择
   - 测试服务类型选择（带司机/自驾）
   - 测试预计时长选择

3. **测试价格计算**
   - 验证价格是否正确计算（根据服务类型和时长）
   - 验证产品列表中的价格显示是否正确

---

### 4. 产品类型切换测试

1. **测试字段清理**
   - 从机票切换到酒店，验证origin和destination是否被清除
   - 从酒店切换到机票，验证city是否被清除
   - 验证切换后字段是否正确显示

---

## ✅ 优化完成

**所有优化已完成！**

- ✅ 添加了默认城市列表（20个常见城市）
- ✅ 机票出发地和目的地改为下拉选择
- ✅ 酒店搜索字段优化（参考携程网）
- ✅ 用车搜索字段优化（参考携程网）
- ✅ 优化了产品类型切换逻辑
- ✅ 优化了搜索记录数据结构
- ✅ 优化了产品列表Mock数据

**现在经典预订搜索功能更符合实际使用习惯！** 🚀

---

**优化完成日期**：2024-12-19  
**状态**：✅ **已完成，可以测试**

