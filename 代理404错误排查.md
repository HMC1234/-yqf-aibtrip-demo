# 代理404错误排查

## ❌ 错误信息

```
HTTP错误: 404 Not Found
响应内容: Cannot POST /api/yqf
```

## 🔍 问题分析

这个错误说明：
1. ✅ 请求确实到达了开发服务器（localhost:3000）
2. ❌ 但是代理没有正确转发请求
3. ❌ 或者代理配置没有生效

## 🔧 可能的原因

### 1. 服务器没有重启（最常见）

**问题**: `setupProxy.js` 的更改需要重启服务器才能生效

**解决方案**:
1. 停止当前服务器（Ctrl+C）
2. 重新启动：`npm start`
3. 等待编译完成

### 2. 代理配置路径问题

**检查**: 确认 `src/setupProxy.js` 文件存在且配置正确

**验证方法**:
- 查看终端是否有代理日志
- 如果看到 `🔵 代理请求:` 日志，说明代理已加载
- 如果没有日志，说明代理未生效

### 3. 请求URL构建问题

**检查**: 确认请求URL格式正确

**正确的URL格式**:
```
http://localhost:3000/api/yqf?app_key=xxx&method=xxx&version=v1
```

**代理后应该转发到**:
```
https://bizapi.yiqifei.cn/servings?app_key=xxx&method=xxx&version=v1
```

## ✅ 修复步骤

### 步骤1: 确认文件存在

检查 `src/setupProxy.js` 文件是否存在：
```bash
# 在项目根目录
dir src\setupProxy.js
```

### 步骤2: 重启服务器

**重要**: 必须重启服务器！

1. 在运行 `npm start` 的终端按 `Ctrl + C`
2. 重新启动：
   ```bash
   npm start
   ```

### 步骤3: 验证代理是否加载

重启后，在终端中应该看到：
- 编译成功消息
- 如果有请求，应该看到 `🔵 代理请求:` 日志

### 步骤4: 测试请求

1. 打开测试页面
2. 填写配置并测试
3. 查看终端日志：
   - 应该看到 `🔵 代理请求:` 日志
   - 应该看到 `🟢 代理响应:` 日志

## 🔍 调试方法

### 方法1: 查看终端日志

在运行 `npm start` 的终端中，应该看到：
```
🔵 代理请求: POST /api/yqf?app_key=...
🔵 代理目标: /servings?app_key=...
🟢 代理响应: 200 /api/yqf?app_key=...
```

### 方法2: 检查浏览器Network标签

1. 打开开发者工具（F12）
2. 切换到 Network 标签
3. 点击"查询航班"
4. 查看请求：
   - **请求URL**: 应该是 `http://localhost:3000/api/yqf?...`
   - **状态码**: 应该是 200 或其他HTTP状态码（不是404）

### 方法3: 检查代理配置

确认 `src/setupProxy.js` 内容正确：
```javascript
module.exports = function(app) {
  app.use(
    '/api/yqf',
    createProxyMiddleware({
      target: 'https://bizapi.yiqifei.cn',
      changeOrigin: true,
      pathRewrite: {
        '^/api/yqf': '/servings',
      },
      // ...
    })
  );
};
```

## ⚠️ 常见问题

### Q1: 为什么还是404？

**A**: 最可能的原因是服务器没有重启。`setupProxy.js` 只在服务器启动时加载。

### Q2: 如何确认代理已加载？

**A**: 查看终端日志。如果看到 `🔵 代理请求:` 日志，说明代理已加载。

### Q3: 代理日志在哪里？

**A**: 在运行 `npm start` 的终端窗口中。

### Q4: 如果重启后还是404？

**A**: 检查：
1. `src/setupProxy.js` 文件是否存在
2. 文件内容是否正确
3. 是否有语法错误
4. 终端是否有错误信息

## 📋 检查清单

- [ ] `src/setupProxy.js` 文件存在
- [ ] 文件内容正确
- [ ] 服务器已重启
- [ ] 终端显示编译成功
- [ ] 测试请求时看到代理日志
- [ ] 浏览器Network标签显示正确的请求URL

## 🎯 下一步

1. **重启服务器**（最重要！）
2. **测试请求**
3. **查看终端日志**
4. **如果还有问题，提供终端日志**

---

**提示**: 99%的404错误都是因为服务器没有重启！

