# 🔧 修复 AccessDenied 错误

**错误信息**：`AccessDenied` - 访问被拒绝

**原因**：存储桶权限配置不正确，或者自定义域名配置有问题

**解决方案**：检查并配置存储桶权限和自定义域名设置

---

## ✅ 快速解决步骤（约5分钟）

### 步骤1：检查存储桶权限

1. **访问COS控制台**
   ```
   https://console.cloud.tencent.com/cos
   ```

2. **进入存储桶**
   - 点击：`yqf-aibtrip-demo-1387623418`
   - 左侧菜单：**权限管理** → **存储桶访问权限**

3. **检查并设置权限**
   - **访问权限**：必须设置为 **公有读私有写** ⭐
   - 如果不是，点击 **编辑**
   - 选择 **公有读私有写**
   - 点击 **保存**

4. **确认权限设置**
   - 确认权限显示为 **公有读私有写**
   - 如果是 **私有读写**，网站无法访问

---

### 步骤2：检查自定义域名配置

1. **进入自定义域名配置**
   - 左侧菜单：**域名与传输管理** → **自定义源站域名**
   - 找到您刚添加的自定义域名

2. **确认源站类型**
   - **源站类型**：必须选择 **静态网站源站** ⭐
   - 如果选择的是 **默认源站**，会返回 AccessDenied

3. **检查域名状态**
   - **状态**：应该显示 **已启用** 或 **正常**
   - **HTTPS**：如果配置了HTTPS，检查证书状态

4. **如果需要，编辑域名**
   - 点击 **编辑**
   - 确认 **源站类型** 为 **静态网站源站**
   - 点击 **保存**

---

### 步骤3：确认静态网站托管已开启

1. **进入静态网站配置**
   - 左侧菜单：**基础配置** → **静态网站**

2. **检查配置**
   - **状态**：必须为 **开启**
   - **索引文档**：设置为 `index.html`
   - **错误文档**：设置为 `index.html`（SPA需要）

3. **如果未开启，开启它**
   - 点击 **编辑**
   - **状态**：选择 **开启**
   - **索引文档**：输入 `index.html`
   - **错误文档**：输入 `index.html`
   - 点击 **保存**

---

### 步骤4：检查文件是否存在

1. **进入文件列表**
   - 左侧菜单：**文件列表**

2. **确认文件存在**
   - 确认根目录下有 `index.html` 文件
   - 确认有 `static` 目录（包含CSS和JS文件）

3. **如果文件不存在，需要重新部署**
   - 访问 GitHub Actions：https://github.com/HMC1234/-yqf-aibtrip-demo/actions
   - 手动触发工作流或等待自动部署

---

### 步骤5：清除CDN缓存（如果使用了CDN）

如果您为自定义域名配置了CDN：

1. **访问CDN控制台**
   ```
   https://console.cloud.tencent.com/cdn
   ```

2. **清除缓存**
   - 选择您的域名
   - 点击 **缓存刷新**
   - 输入 `/` 或 `/*`
   - 点击 **提交**

3. **等待生效**（通常几分钟）

---

## 🔍 问题诊断

### 常见原因和解决方案

#### 原因1：存储桶权限为"私有读写"

**问题**：存储桶访问权限设置为"私有读写"

**解决**：
1. 进入存储桶 → **权限管理** → **存储桶访问权限**
2. 设置为 **公有读私有写**
3. 保存

---

#### 原因2：自定义域名源站类型错误

**问题**：自定义域名选择了"默认源站"而不是"静态网站源站"

**解决**：
1. 进入存储桶 → **域名与传输管理** → **自定义源站域名**
2. 找到您的域名，点击 **编辑**
3. **源站类型**：选择 **静态网站源站** ⭐
4. 保存

---

#### 原因3：静态网站托管未开启

**问题**：静态网站托管功能未开启

**解决**：
1. 进入存储桶 → **基础配置** → **静态网站**
2. 点击 **编辑**
3. **状态**：选择 **开启**
4. **索引文档**：`index.html`
5. **错误文档**：`index.html`
6. 保存

---

#### 原因4：文件不存在

**问题**：存储桶中没有 `index.html` 文件

**解决**：
1. 检查文件列表，确认文件存在
2. 如果不存在，重新运行 GitHub Actions 工作流
3. 或手动上传文件

---

#### 原因5：DNS解析问题

**问题**：DNS解析未正确配置或未生效

**解决**：
1. 检查DNS解析是否正确配置
2. 使用工具检查CNAME记录：
   - https://tool.chinaz.com/dns/
   - 输入您的域名，检查CNAME记录
3. 确认CNAME记录指向COS提供的地址

---

## ✅ 配置检查清单

**请确认以下配置**：

### 存储桶权限
- [ ] 访问权限设置为 **公有读私有写**
- [ ] 不是 **私有读写**

### 自定义域名配置
- [ ] 自定义域名已添加
- [ ] 源站类型为 **静态网站源站** ⭐
- [ ] 不是 **默认源站**
- [ ] 域名状态为 **已启用** 或 **正常**

### 静态网站托管
- [ ] 静态网站托管已开启
- [ ] 索引文档设置为 `index.html`
- [ ] 错误文档设置为 `index.html`

### 文件存在
- [ ] 根目录下有 `index.html` 文件
- [ ] 有 `static` 目录和文件

### DNS配置（如果使用自定义域名）
- [ ] DNS CNAME记录已配置
- [ ] CNAME记录指向正确的COS地址
- [ ] DNS解析已生效

---

## 🚀 验证步骤

配置完成后，验证：

1. **访问您的自定义域名**
   ```
   https://您的自定义域名
   ```

2. **应该看到**：
   - ✅ 网页正常显示
   - ✅ 不是 AccessDenied 错误
   - ✅ 不是下载文件
   - ✅ 页面功能正常

3. **如果仍然有错误**：
   - 检查浏览器控制台（F12）
   - 查看错误信息
   - 检查网络请求状态码

---

## 📋 常见错误码

### AccessDenied (403)
- **原因**：权限不足
- **解决**：检查存储桶权限是否为"公有读私有写"

### NoSuchBucket (404)
- **原因**：存储桶不存在或名称错误
- **解决**：检查存储桶名称是否正确

### NoSuchKey (404)
- **原因**：文件不存在
- **解决**：检查文件列表，确认 `index.html` 存在

---

**请按照步骤1-3检查并修复配置！** 🚀

**最关键的是：存储桶权限必须为"公有读私有写"，自定义域名源站类型必须为"静态网站源站"！** ⭐


