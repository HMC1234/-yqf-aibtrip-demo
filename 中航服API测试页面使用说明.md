# 中航服API测试页面使用说明

## 📍 访问地址

测试页面已添加到路由中，访问地址：
- **URL**: `/test/yqf-api`
- 或通过浏览器直接访问：`http://localhost:3000/test/yqf-api`

## 🎯 功能说明

测试页面包含4个主要功能标签页：

### 1. 配置标签页

#### 功能
- 配置API基础信息（Base URL、App Key、App Secret）
- 测试加密功能

#### 使用步骤
1. **填写配置信息**：
   - `API Base URL`: 中航服API的基础地址
   - `App Key`: 应用密钥（app_key）
   - `App Secret`: 应用密钥（app_secret，用于加密）
   - `API Version`: API版本（默认v1）

2. **保存配置**：
   - 点击"保存配置"按钮
   - 配置仅本次会话有效（刷新页面后需要重新配置）

3. **测试加密**：
   - 在"测试文本"框中输入JSON格式的文本（如：`{"test": "data"}`）
   - 点击"测试加密"按钮
   - 查看加密结果

### 2. 航班查询标签页

#### 功能
- 测试航班查询接口（`EasyShopping_V2`）
- 支持单程和往返查询

#### 使用步骤
1. **填写查询参数**：
   - `出发地`: 选择出发城市
   - `目的地`: 选择目的地城市
   - `出发日期`: 选择出发日期
   - `回程日期`: 可选，如果选择则为往返查询
   - `乘客类型`: ADT（成人）/CHD（儿童）/INF（婴儿）
   - `舱位类型`: Y（经济舱）/C（商务舱）/F（头等舱）
   - `航班类型`: D（国内）/A（国际）
   - `仅直飞`: 是否只查询直飞航班
   - `查询退改规则`: 是否查询退改规则

2. **执行查询**：
   - 点击"查询航班"按钮
   - 等待响应结果

3. **查看结果**：
   - 响应数据会显示在页面下方的"响应数据"卡片中
   - 包含完整的请求参数和响应数据（JSON格式）

### 3. 验价标签页

#### 功能
- 测试验价接口（`VerifyPriceServing`）
- 验证座位可用性和价格准确性

#### 使用步骤
1. **填写验价参数**：
   - `FQKey`: 从航班查询接口获取的FQKey（必填）
   - `乘客类型`: ADT（成人）/CHD（儿童）/INF（婴儿）
   - `证件类型`: ID（身份证）/PASSPORT（护照）
   - `证件号码`: 乘客证件号码
   - `生日`: 可选，非身份证时必须填写

2. **执行验价**：
   - 点击"验价"按钮
   - 等待响应结果

3. **查看结果**：
   - 响应数据会显示在页面下方
   - 如果验价成功，可以使用返回的FQKey创建订单

### 4. 创建订单标签页

#### 功能
- 测试创建订单接口（`AICreateOrder`）
- 支持机票订单创建

#### 使用步骤
1. **填写订单信息**：
   - **订单信息**：
     - `来源类型ID`: 默认1
     - `支付方式ID`: 默认1
     - `结算类型ID`: 默认11
   
   - **产品信息**：
     - `产品类别ID`: 8（国内机票）/9（国际机票）
     - `GDS代码`: 默认1E
     - `公开价格`: 订单价格
     - `FQKey`: 从验价接口获取的FQKey（必填）
     - `行程类型`: 1（单程）/2（往返）
   
   - **乘客信息**：
     - `姓`、`名`: 乘客姓名
     - `乘客类型`: ADT/CHD/INF
     - `性别`: M（男）/F（女）
     - `证件类型`: ID/PASSPORT
     - `证件号码`: 乘客证件号码
     - `手机号`: 乘客手机号
     - `生日`: 可选，非身份证时必须填写
     - `证件有效期`: 可选
   
   - **联系人信息**：
     - `联系人姓名`: 联系人姓名
     - `联系人手机`: 联系人手机号
     - `联系人邮箱`: 可选

2. **执行创建订单**：
   - 点击"创建订单"按钮
   - 等待响应结果

3. **查看结果**：
   - 响应数据会显示在页面下方
   - 如果成功，会返回TradeNo和订单列表

## 📊 响应数据说明

所有接口调用后，响应数据会以JSON格式显示在页面下方的"响应数据"卡片中，包括：

- **请求参数**: 发送给API的完整参数
- **响应数据**: API返回的完整响应
- **时间戳**: 调用时间
- **错误信息**: 如果调用失败，会显示错误信息

### 响应格式示例

```json
{
  "request": {
    // 请求参数
  },
  "response": {
    "Code": 0,
    "Msg": "调用成功",
    "Data": {
      // 业务数据
    }
  },
  "timestamp": "2024-12-20T10:30:00.000Z"
}
```

## ⚠️ 注意事项

### 1. 配置管理
- 配置信息仅保存在浏览器内存中，刷新页面后会丢失
- 建议将配置信息保存到环境变量中（生产环境）

### 2. FQKey使用
- FQKey有时效性，需要及时使用
- 建议在查询航班后立即进行验价
- 验价成功后立即创建订单

### 3. 完整流程
推荐的测试流程：
1. **配置** → 填写API配置信息
2. **查询航班** → 获取可用航班列表和FQKey
3. **验价** → 使用FQKey进行验价
4. **创建订单** → 使用验价返回的FQKey创建订单

### 4. 错误处理
- 如果API调用失败，错误信息会显示在响应数据中
- 检查配置是否正确
- 检查参数是否完整
- 检查网络连接

### 5. 数据格式
- 所有日期格式：`YYYY-MM-DD`
- 所有时间格式：`HH:mm`
- 证件号码：身份证18位，护照按实际格式

## 🔧 常见问题

### Q1: 提示"配置不完整"
**A**: 请先在"配置"标签页填写完整的API配置信息并保存。

### Q2: 加密测试失败
**A**: 检查App Secret长度是否为16或32字节。

### Q3: 查询航班返回空结果
**A**: 
- 检查出发地和目的地是否正确
- 检查日期是否有效（不能是过去的日期）
- 检查航班类型（国内/国际）是否正确

### Q4: 验价失败
**A**: 
- 检查FQKey是否正确（从查询接口获取）
- 检查FQKey是否过期（有时效性）
- 检查乘客信息是否完整

### Q5: 创建订单失败
**A**: 
- 检查FQKey是否正确（从验价接口获取）
- 检查所有必填字段是否填写
- 检查乘客信息是否完整

## 📝 测试建议

1. **先测试配置和加密**：确保加密功能正常
2. **测试简单查询**：使用默认参数测试航班查询
3. **测试完整流程**：按照配置→查询→验价→创建订单的顺序测试
4. **测试错误情况**：测试各种错误场景（如缺少参数、无效数据等）

## 🎉 使用提示

- 所有输入框都有默认值，可以直接使用
- 响应数据支持复制（点击文本框即可全选复制）
- 可以清空响应数据重新测试
- 支持同时测试多个接口（切换标签页即可）

---

**提示**: 这是一个测试工具，用于验证API集成是否正确。在生产环境中，应该使用环境变量配置，而不是在页面中输入配置信息。

