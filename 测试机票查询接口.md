# 测试机票查询接口

## 测试参数

根据您的要求，已设置以下测试参数：
- **出发地**：广州（CAN）
- **目的地**：北京（PEK）
- **出发日期**：2025年12月1日

## 快速测试步骤

### 1. 打开测试页面

访问：`http://localhost:3000/test/yqf-api`

### 2. 配置API信息

在"配置"标签页填写：
- **API Base URL**：`https://bizapi.yiqifei.cn/servings`（已默认）
- **App Key**：您的应用密钥
- **App Secret**：您的应用密钥（16或32字节）
- **API Version**：`2.0`（已默认）
- **注册公司（OfficeIds）**：`EI00D`（已默认，请根据实际情况修改）

点击"保存配置"

### 3. 测试航班查询

切换到"航班查询"标签页，参数已自动填充：
- ✅ **出发地**：广州（已默认）
- ✅ **目的地**：北京（已默认）
- ✅ **出发日期**：2025-12-01（已默认）
- ✅ **乘客类型**：成人（ADT）
- ✅ **航班类型**：国内（D）
- ✅ **舱位类型**：经济舱（Y）
- ✅ **注册公司（OfficeIds）**：EI00D

直接点击"查询航班"按钮即可！

### 4. 查看结果

在页面下方查看响应数据：
- 如果成功，会显示航班列表和详细信息
- 如果失败，会显示错误信息

## 实际请求参数

系统会发送以下请求：

**URL**：
```
https://bizapi.yiqifei.cn/servings?version=2.0&app_key=your_app_key&method=ShoppingServer.EasyShopping_V2
```

**Body（加密后）**：
```json
{
  "Passengers": [{"PassengerType": "ADT"}],
  "Routings": [
    {
      "Departure": "CAN",  // 广州
      "Arrival": "PEK",   // 北京
      "DepartureDate": "2025-12-01",
      "DepartureType": 1,
      "ArrivalType": 1
    }
  ],
  "OfficeIds": ["EI00D"],  // 注册公司（必填）
  "Type": "D",             // 国内
  "OnlyDirectFlight": false,
  "BerthType": "Y",        // 经济舱
  "ChildQty": 0,
  "IsQueryRule": false,
  "IsQueryAirline": false,
  "CodeShare": false,
  "IsQueryAirport": false
}
```

## 预期响应

### 成功响应示例

```json
{
  "Code": 0,
  "Msg": "调用成功",
  "Data": {
    "Segment": [
      {
        "SegmentCode": "...",
        "Departure": "CAN",
        "Arrival": "PEK",
        "DepartureDate": "2025-12-01T...",
        "Flight": [
          {
            "FlightCode": "...",
            "FlightNumber": "CA1234",
            "MarketingAirline": "CA",
            "DepartureDate": "2025-12-01T08:00:00",
            "ArrivalDate": "2025-12-01T11:00:00",
            ...
          }
        ],
        ...
      }
    ],
    "JourneyBiz": [...],
    "Fare": [...],
    ...
  }
}
```

## 调试信息

测试时，请查看：

1. **浏览器控制台（F12）**：
   - 查看请求URL
   - 查看请求参数
   - 查看响应数据

2. **Network标签**：
   - 查看实际HTTP请求
   - 查看请求头
   - 查看响应状态码

3. **终端日志**（如果使用代理）：
   - 查看代理转发日志

## 常见问题

### Q1: 仍然404错误？

**A**: 
- 检查API Base URL是否正确
- 如果使用代理，检查代理是否已加载
- 查看Network标签中的实际请求URL

### Q2: CORS错误？

**A**: 
- 尝试将API Base URL改为 `/api/yqf` 使用代理
- 确保代理服务器已启动

### Q3: 参数错误？

**A**: 
- 检查 `OfficeIds` 是否正确（必填）
- 检查 `version` 是否为 `2.0`（必填）
- 检查 `app_key` 和 `app_secret` 是否正确

## 测试结果

测试完成后，请告诉我：
1. 是否成功？
2. 返回了什么数据？
3. 如果失败，错误信息是什么？

