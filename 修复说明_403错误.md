# 修复403错误 - RLS策略问题

## 问题原因

Supabase的Row Level Security (RLS)策略只允许用户**查看**自己的数据，但没有允许**插入**数据。

## 解决方案

需要在Supabase中执行以下SQL来添加INSERT权限。

## 执行步骤

### 步骤1：打开Supabase Dashboard

1. 访问 https://supabase.com/dashboard
2. 选择项目：YQFAIBTRIP
3. 点击左侧菜单 **SQL Editor**

### 步骤2：执行修复脚本

打开项目中的 `修复RLS策略.sql` 文件，复制全部内容，在SQL Editor中执行。

或者直接执行以下SQL：

```sql
-- 允许用户插入自己的出差申请
CREATE POLICY "Users can insert own travel requests" ON travel_requests
    FOR INSERT WITH CHECK (auth.uid() = user_id);

-- 允许用户更新自己的出差申请（在审批前）
CREATE POLICY "Users can update own travel requests" ON travel_requests
    FOR UPDATE USING (auth.uid() = user_id);

-- 允许用户插入自己的订单
CREATE POLICY "Users can insert own orders" ON orders
    FOR INSERT WITH CHECK (auth.uid() = user_id);

-- 允许用户插入自己的AI推荐方案
CREATE POLICY "Users can insert own recommendations" ON ai_recommendations
    FOR INSERT WITH CHECK (auth.uid() = user_id);

-- 允许用户更新自己的AI推荐方案
CREATE POLICY "Users can update own recommendations" ON ai_recommendations
    FOR UPDATE USING (auth.uid() = user_id);

-- 允许用户插入推荐方案详情
CREATE POLICY "Users can insert recommendation details" ON recommendation_details
    FOR INSERT WITH CHECK (
        EXISTS (
            SELECT 1 FROM ai_recommendations 
            WHERE ai_recommendations.id = recommendation_details.ai_recommendation_id 
            AND ai_recommendations.user_id = auth.uid()
        )
    );

-- 允许用户查看推荐方案详情
CREATE POLICY "Users can view recommendation details" ON recommendation_details
    FOR SELECT USING (
        EXISTS (
            SELECT 1 FROM ai_recommendations 
            WHERE ai_recommendations.id = recommendation_details.ai_recommendation_id 
            AND ai_recommendations.user_id = auth.uid()
        )
    );
```

### 步骤3：验证

执行后应该显示 "Success"。

### 步骤4：测试

返回应用，再次尝试提交出差申请，应该可以成功了。

---

## 已修复的问题

1. ✅ 路由配置问题（Outlet为null）- 已修复
2. ⚠️ RLS策略问题（403错误）- 需要执行SQL脚本

---

**执行完SQL脚本后，请告诉我结果！**






