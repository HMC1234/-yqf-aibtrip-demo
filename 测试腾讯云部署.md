# 🧪 测试腾讯云自动部署

**测试日期**：2024-12-19  
**GitHub仓库**：https://github.com/HMC1234/-yqf-aibtrip-demo

---

## ✅ 配置检查清单

在开始测试之前，请确认以下配置：

### 1. GitHub Secrets配置 ✅

**已配置的Secrets**：
- ✅ `TENCENT_SECRET_ID` - 腾讯云SecretId
- ✅ `TENCENT_SECRET_KEY` - 腾讯云SecretKey
- ✅ `TENCENT_BUCKET` - COS存储桶名称（可选，如果使用默认值）
- ✅ `TENCENT_REGION` - COS地域（可选，如果使用默认值）

**检查地址**：
https://github.com/HMC1234/-yqf-aibtrip-demo/settings/secrets/actions

---

### 2. 腾讯云COS配置 ✅

**已完成的配置**：
- ✅ COS存储桶已创建
- ✅ 存储桶权限设置为"公有读私有写"
- ✅ 静态网站托管已开启
- ✅ 索引文档设置为`index.html`
- ✅ 错误文档设置为`index.html`（SPA需要）

**检查地址**：
https://console.cloud.tencent.com/cos

---

## 🚀 测试自动部署

### 方式1：手动触发部署（推荐）⭐

1. **访问GitHub Actions**
   - 访问：https://github.com/HMC1234/-yqf-aibtrip-demo/actions

2. **选择工作流**
   - 点击"Deploy to Tencent Cloud COS"工作流

3. **手动触发**
   - 点击"Run workflow"按钮
   - 选择分支：`main`
   - 点击"Run workflow"

4. **查看部署日志**
   - 等待部署完成（约3-5分钟）
   - 查看构建和部署日志
   - 确认是否成功

---

### 方式2：推送代码触发部署

如果您想要通过推送代码触发部署：

```bash
# 做一个小改动（例如添加测试标记）
echo "<!-- 测试部署 -->" >> public/index.html
git add public/index.html
git commit -m "test: 测试腾讯云自动部署"
git push origin main
```

推送后，GitHub Actions会自动触发部署。

---

## 📋 部署流程说明

### 自动部署流程

1. **触发条件**
   - 推送到`main`分支
   - 或手动触发工作流

2. **构建阶段**
   - 安装依赖（`npm ci`）
   - 构建项目（`npm run build`）
   - 输出到`build`目录

3. **部署阶段**
   - 安装coscmd工具
   - 配置coscmd（使用GitHub Secrets）
   - 上传`build`目录到COS
   - 设置`index.html`缓存策略

4. **完成**
   - 显示部署完成的摘要信息
   - 显示访问地址

---

## ✅ 验证部署结果

### 1. 检查GitHub Actions状态

1. **访问GitHub Actions**
   - https://github.com/HMC1234/-yqf-aibtrip-demo/actions

2. **查看最新运行**
   - 点击最新的工作流运行
   - 查看所有步骤的状态
   - 确认是否全部成功（绿色✓）

3. **查看日志**
   - 点击每个步骤查看详细日志
   - 确认是否有错误信息

---

### 2. 检查COS文件

1. **访问COS控制台**
   - https://console.cloud.tencent.com/cos

2. **检查文件**
   - 进入您的存储桶
   - 查看文件列表
   - 确认`build`目录下的文件已上传

3. **检查文件结构**
   - 根目录应有`index.html`
   - `static`目录应有CSS和JS文件

---

### 3. 访问部署的网站

**访问地址**：
```
https://<您的存储桶名称>.cos-website.<您的地域>.myqcloud.com
```

**示例**：
```
https://yqf-aibtrip-demo.cos-website.ap-guangzhou.myqcloud.com
```

**验证内容**：
- ✅ 网站可以正常访问
- ✅ 静态资源加载正常
- ✅ 页面功能正常
- ✅ SPA路由正常工作（无404错误）

---

## 🔧 常见问题排查

### 问题1：部署失败 - 认证失败

**症状**：GitHub Actions日志显示认证失败

**可能原因**：
- SecretId或SecretKey配置错误
- Secrets中的值有多余的空格
- 密钥权限不足

**解决方法**：
1. 检查GitHub Secrets中的值是否正确
2. 确保没有多余的空格
3. 验证密钥是否有COS访问权限

---

### 问题2：部署失败 - 存储桶不存在

**症状**：GitHub Actions日志显示存储桶不存在

**可能原因**：
- 存储桶名称配置错误
- 地域配置错误

**解决方法**：
1. 检查GitHub Secret `TENCENT_BUCKET`是否正确
2. 检查GitHub Secret `TENCENT_REGION`是否正确
3. 确认存储桶确实存在

---

### 问题3：网站无法访问

**症状**：部署成功但网站无法访问

**可能原因**：
- 存储桶权限设置错误
- 静态网站托管未开启
- DNS传播需要时间

**解决方法**：
1. 确认存储桶权限为"公有读私有写"
2. 确认静态网站托管已开启
3. 等待1-2分钟后重试

---

### 问题4：路由404错误

**症状**：访问子路由出现404错误

**可能原因**：
- 错误文档未设置为`index.html`

**解决方法**：
1. 进入COS控制台
2. 存储桶 → "基础配置" → "静态网站"
3. 确保错误文档设置为`index.html`

---

## 📝 后续维护

### 自动部署

完成配置后，每次推送到`main`分支都会自动触发部署：

1. **正常开发流程**
   ```bash
   # 修改代码
   git add .
   git commit -m "feat: 新功能"
   git push origin main
   ```

2. **自动部署**
   - GitHub Actions自动检测到推送
   - 自动构建和部署
   - 约3-5分钟后更新完成

---

### 查看部署历史

1. **GitHub Actions**
   - 访问：https://github.com/HMC1234/-yqf-aibtrip-demo/actions
   - 查看所有部署历史记录

2. **COS控制台**
   - 访问：https://console.cloud.tencent.com/cos
   - 查看文件更新时间和访问日志

---

## ✅ 完成

配置完成后，您的代码会自动部署到腾讯云！

**同时部署到**：
- ✅ Vercel（自动）
- ✅ 腾讯云COS（自动）

---

**测试完成后，请告诉我结果！** 🚀

