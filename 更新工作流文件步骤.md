# ğŸ”§ æ›´æ–°GitHub Actionså·¥ä½œæµæ–‡ä»¶

**é—®é¢˜**ï¼šå·¥ä½œæµæ‰§è¡Œå¤±è´¥ï¼Œé”™è¯¯ä»£ç 255

**è§£å†³æ–¹æ¡ˆ**ï¼šæ›´æ–°å·¥ä½œæµæ–‡ä»¶ï¼Œæ·»åŠ æ›´å¥½çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—

---

## ğŸ“‹ æ›´æ–°æ­¥éª¤

### æ­¥éª¤1ï¼šè®¿é—®å·¥ä½œæµæ–‡ä»¶

**è®¿é—®**ï¼š
```
https://github.com/HMC1234/-yqf-aibtrip-demo/blob/main/.github/workflows/deploy-tencent.yml
```

æˆ–è€…ï¼š
1. è®¿é—®ä»“åº“ï¼šhttps://github.com/HMC1234/-yqf-aibtrip-demo
2. è¿›å…¥`.github/workflows/`ç›®å½•
3. ç‚¹å‡»`deploy-tencent.yml`æ–‡ä»¶

---

### æ­¥éª¤2ï¼šç¼–è¾‘æ–‡ä»¶

1. **ç‚¹å‡»ç¼–è¾‘æŒ‰é’®**
   - ç‚¹å‡»å³ä¸Šè§’çš„"Edit"ï¼ˆé“…ç¬”å›¾æ ‡ï¼‰

2. **æ›¿æ¢æ–‡ä»¶å†…å®¹**
   - åˆ é™¤ç°æœ‰å†…å®¹
   - å¤åˆ¶ä»¥ä¸‹æ”¹è¿›åçš„å†…å®¹å¹¶ç²˜è´´

---

### æ­¥éª¤3ï¼šæ”¹è¿›åçš„å·¥ä½œæµæ–‡ä»¶å†…å®¹

```yaml
name: Deploy to Tencent Cloud COS

on:
  push:
    branches:
      - main
  workflow_dispatch:

env:
  REGION: ap-guangzhou
  BUCKET: yqf-aibtrip-demo

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build project
        run: npm run build
        env:
          CI: false

      - name: Setup Python for coscmd
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install coscmd
        run: |
          pip install coscmd

      - name: Configure coscmd
        env:
          SECRET_ID: ${{ secrets.TENCENT_SECRET_ID }}
          SECRET_KEY: ${{ secrets.TENCENT_SECRET_KEY }}
          BUCKET: ${{ secrets.TENCENT_BUCKET || env.BUCKET }}
          REGION: ${{ secrets.TENCENT_REGION || env.REGION }}
        run: |
          echo "é…ç½®coscmd..."
          echo "å­˜å‚¨æ¡¶: $BUCKET"
          echo "åœ°åŸŸ: $REGION"
          
          if [ -z "$SECRET_ID" ] || [ -z "$SECRET_KEY" ]; then
            echo "âŒ é”™è¯¯: SecretIdæˆ–SecretKeyæœªé…ç½®"
            exit 1
          fi
          
          coscmd config -a "$SECRET_ID" -s "$SECRET_KEY" -b "$BUCKET" -r "$REGION"
          
          if [ $? -ne 0 ]; then
            echo "âŒ coscmdé…ç½®å¤±è´¥"
            exit 1
          fi
          
          echo "âœ… coscmdé…ç½®æˆåŠŸ"

      - name: Deploy to Tencent COS
        env:
          BUCKET: ${{ secrets.TENCENT_BUCKET || env.BUCKET }}
          REGION: ${{ secrets.TENCENT_REGION || env.REGION }}
        run: |
          echo "å¼€å§‹ä¸Šä¼ æ–‡ä»¶åˆ°COS..."
          echo "å­˜å‚¨æ¡¶: $BUCKET"
          echo "åœ°åŸŸ: $REGION"
          
          # æ£€æŸ¥buildç›®å½•æ˜¯å¦å­˜åœ¨
          if [ ! -d "build" ]; then
            echo "âŒ é”™è¯¯: buildç›®å½•ä¸å­˜åœ¨"
            exit 1
          fi
          
          # æ£€æŸ¥index.htmlæ˜¯å¦å­˜åœ¨
          if [ ! -f "build/index.html" ]; then
            echo "âŒ é”™è¯¯: build/index.htmlä¸å­˜åœ¨"
            exit 1
          fi
          
          # ä¸Šä¼ æ‰€æœ‰æ–‡ä»¶
          echo "ä¸Šä¼ buildç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶..."
          coscmd upload -rs build/ /
          
          if [ $? -ne 0 ]; then
            echo "âŒ æ–‡ä»¶ä¸Šä¼ å¤±è´¥"
            exit 1
          fi
          
          echo "âœ… æ–‡ä»¶ä¸Šä¼ æˆåŠŸ"
          
          # è®¾ç½®index.htmlç¼“å­˜ç­–ç•¥
          echo "è®¾ç½®index.htmlç¼“å­˜ç­–ç•¥..."
          coscmd put build/index.html /index.html -H '{"Cache-Control":"no-cache, no-store, must-revalidate", "Content-Type":"text/html; charset=utf-8"}'
          
          if [ $? -ne 0 ]; then
            echo "âš ï¸ è­¦å‘Š: index.htmlç¼“å­˜ç­–ç•¥è®¾ç½®å¤±è´¥ï¼Œä½†æ–‡ä»¶å·²ä¸Šä¼ "
          else
            echo "âœ… index.htmlç¼“å­˜ç­–ç•¥è®¾ç½®æˆåŠŸ"
          fi
          
          echo "âœ… éƒ¨ç½²å®Œæˆï¼"
          
      - name: Deployment Summary
        env:
          BUCKET: ${{ secrets.TENCENT_BUCKET || env.BUCKET }}
          REGION: ${{ secrets.TENCENT_REGION || env.REGION }}
          CDN_DOMAIN: ${{ secrets.TENCENT_CDN_DOMAIN }}
        run: |
          echo "âœ… éƒ¨ç½²å®Œæˆï¼"
          echo "ğŸ“¦ å­˜å‚¨æ¡¶: $BUCKET"
          echo "ğŸ“ åœ°åŸŸ: $REGION"
          if [ -n "$CDN_DOMAIN" ]; then
            echo "ğŸŒ CDNåœ°å€: https://$CDN_DOMAIN"
          else
            echo "ğŸŒ COSåœ°å€: https://$BUCKET.cos-website.$REGION.myqcloud.com"
          fi
```

---

### æ­¥éª¤4ï¼šæäº¤æ›´æ”¹

1. **å¡«å†™æäº¤ä¿¡æ¯**
   - åœ¨é¡µé¢ä¸‹æ–¹çš„"Commit changes"åŒºåŸŸ
   - æäº¤ä¿¡æ¯ï¼š`fix: æ”¹è¿›å·¥ä½œæµé”™è¯¯å¤„ç†å’Œæ—¥å¿—è¾“å‡º`
   - é€‰æ‹©"Commit directly to the main branch"

2. **ç‚¹å‡»"Commit changes"æŒ‰é’®**

---

## ğŸ” è¯Šæ–­å…·ä½“é”™è¯¯

æ›´æ–°æ–‡ä»¶åï¼Œå†æ¬¡è¿è¡Œå·¥ä½œæµï¼Œæ–°çš„æ—¥å¿—ä¼šæ˜¾ç¤ºï¼š

1. **å“ªä¸ªæ­¥éª¤å¤±è´¥äº†**
2. **å…·ä½“çš„é”™è¯¯ä¿¡æ¯**
3. **é…ç½®ä¿¡æ¯ï¼ˆå­˜å‚¨æ¡¶ã€åœ°åŸŸç­‰ï¼‰**

**è¯·å‘Šè¯‰æˆ‘**ï¼š
- å“ªä¸ªæ­¥éª¤å¤±è´¥äº†ï¼Ÿ
- é”™è¯¯æ—¥å¿—ä¸­æ˜¾ç¤ºçš„å…·ä½“é”™è¯¯ä¿¡æ¯æ˜¯ä»€ä¹ˆï¼Ÿ

**æˆ‘ä¼šæ ¹æ®å…·ä½“é”™è¯¯æä¾›é’ˆå¯¹æ€§çš„è§£å†³æ–¹æ¡ˆï¼**

---

## ğŸ“‹ å¸¸è§é”™è¯¯å¿«é€Ÿæ£€æŸ¥

åœ¨æ›´æ–°æ–‡ä»¶ä¹‹å‰ï¼Œè¯·å…ˆæ£€æŸ¥ï¼š

### 1. GitHub Secretsé…ç½®

**è®¿é—®**ï¼šhttps://github.com/HMC1234/-yqf-aibtrip-demo/settings/secrets/actions

**æ£€æŸ¥**ï¼š
- âœ… `TENCENT_SECRET_ID` å­˜åœ¨ä¸”æ­£ç¡®
- âœ… `TENCENT_SECRET_KEY` å­˜åœ¨ä¸”æ­£ç¡®
- âœ… æ²¡æœ‰å¤šä½™çš„ç©ºæ ¼æˆ–æ¢è¡Œ

### 2. å­˜å‚¨æ¡¶é…ç½®

**è®¿é—®**ï¼šhttps://console.cloud.tencent.com/cos

**æ£€æŸ¥**ï¼š
- âœ… å­˜å‚¨æ¡¶åç§°æ˜¯å¦æ­£ç¡®
- âœ… åœ°åŸŸä»£ç æ˜¯å¦æ­£ç¡®
- âœ… å­˜å‚¨æ¡¶æƒé™æ˜¯å¦ä¸º"å…¬æœ‰è¯»ç§æœ‰å†™"

---

**è¯·å…ˆæ›´æ–°å·¥ä½œæµæ–‡ä»¶ï¼Œç„¶åå†æ¬¡è¿è¡Œï¼Œå‘Šè¯‰æˆ‘å…·ä½“çš„é”™è¯¯ä¿¡æ¯ï¼** ğŸ”§


