# ä¿®å¤å®¡æ‰¹æƒé™å­—æ®µç¼ºå¤±é—®é¢˜

## ğŸ” é”™è¯¯ä¿¡æ¯

```
Could not find the 'can_approve' column of 'users' in the schema cache
```

è¿™ä¸ªé”™è¯¯è¯´æ˜ï¼š**æ•°æ®åº“ä¸­ `users` è¡¨è¿˜æ²¡æœ‰ `can_approve` å­—æ®µ**

## âœ… è§£å†³æ–¹æ¡ˆ

### æ­¥éª¤ 1ï¼šåœ¨ Supabase ä¸­æ·»åŠ å­—æ®µ

åœ¨ **Supabase SQL Editor** ä¸­æ‰§è¡Œä»¥ä¸‹è„šæœ¬ï¼š

```sql
-- ============================================
-- ä¿®å¤å®¡æ‰¹æƒé™å­—æ®µç¼ºå¤±é—®é¢˜
-- ============================================

-- 1. æ·»åŠ  can_approve å­—æ®µï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
ALTER TABLE users 
ADD COLUMN IF NOT EXISTS can_approve BOOLEAN DEFAULT true;

-- 2. éªŒè¯å­—æ®µæ˜¯å¦æ·»åŠ æˆåŠŸ
SELECT column_name, data_type, column_default
FROM information_schema.columns
WHERE table_name = 'users' 
AND column_name = 'can_approve';

-- 3. ä¸ºæ‰€æœ‰ç°æœ‰ç”¨æˆ·è®¾ç½®é»˜è®¤å€¼ï¼ˆå¦‚æœä¸ºNULLï¼‰
UPDATE users 
SET can_approve = true 
WHERE can_approve IS NULL;

-- 4. ç¡®ä¿ test@example.com ç”¨æˆ·æœ‰å®¡æ‰¹æƒé™
UPDATE users 
SET can_approve = true,
    updated_at = NOW()
WHERE email = 'test@example.com';

-- 5. éªŒè¯è®¾ç½®ç»“æœ
SELECT 
    email,
    can_approve,
    CASE 
        WHEN can_approve = true THEN 'âœ… æœ‰æƒé™'
        WHEN can_approve = false THEN 'âŒ æ— æƒé™'
        ELSE 'âš ï¸ æœªè®¾ç½®ï¼ˆNULLï¼‰'
    END AS æƒé™çŠ¶æ€
FROM users
WHERE email = 'test@example.com';
```

### æ­¥éª¤ 2ï¼šæ¸…é™¤ Supabase Schema Cacheï¼ˆå¦‚æœéœ€è¦ï¼‰

å¦‚æœæ‰§è¡Œäº† SQL åä»ç„¶æŠ¥é”™ï¼Œå¯èƒ½éœ€è¦æ¸…é™¤ Supabase çš„ schema cacheï¼š

1. **æ–¹æ³•ä¸€ï¼šç­‰å¾…å‡ ç§’é’Ÿ**
   - Supabase çš„ schema cache é€šå¸¸ä¼šåœ¨ä¸€æ®µæ—¶é—´åè‡ªåŠ¨åˆ·æ–°ï¼ˆçº¦ 10-30 ç§’ï¼‰
   - åˆ·æ–°æµè§ˆå™¨é¡µé¢ï¼Œå†æ¬¡å°è¯•

2. **æ–¹æ³•äºŒï¼šé‡å¯ Supabase é¡¹ç›®**ï¼ˆå¦‚æœæ–¹æ³•ä¸€ä¸è¡Œï¼‰
   - åœ¨ Supabase Dashboard ä¸­
   - è¿›å…¥ **Settings** â†’ **General**
   - æ‰¾åˆ° **Restart project** é€‰é¡¹
   - ç‚¹å‡»é‡å¯ï¼ˆè¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰

3. **æ–¹æ³•ä¸‰ï¼šåœ¨ Supabase Dashboard ä¸­åˆ·æ–° schema**
   - è¿›å…¥ **Database** â†’ **Tables**
   - ç‚¹å‡» `users` è¡¨
   - æŸ¥çœ‹åˆ—ï¼ˆColumnsï¼‰åˆ—è¡¨
   - ç¡®è®¤ `can_approve` å­—æ®µæ˜¯å¦å­˜åœ¨
   - å¦‚æœä¸å­˜åœ¨ï¼Œé‡æ–°æ‰§è¡Œæ­¥éª¤ 1 çš„ SQL

### æ­¥éª¤ 3ï¼šéªŒè¯å­—æ®µå·²æ·»åŠ 

æ‰§è¡Œä»¥ä¸‹ SQL éªŒè¯å­—æ®µæ˜¯å¦å­˜åœ¨ï¼š

```sql
-- æ£€æŸ¥å­—æ®µæ˜¯å¦å­˜åœ¨
SELECT 
    column_name,
    data_type,
    column_default,
    is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
AND table_name = 'users'
AND column_name = 'can_approve';
```

**é¢„æœŸç»“æœ**ï¼šåº”è¯¥è¿”å›ä¸€è¡Œè®°å½•ï¼Œæ˜¾ç¤º `can_approve` å­—æ®µçš„ä¿¡æ¯

### æ­¥éª¤ 4ï¼šæµ‹è¯•åŠŸèƒ½

1. **åˆ·æ–°æµè§ˆå™¨é¡µé¢**ï¼ˆæŒ‰ Ctrl+F5 å¼ºåˆ¶åˆ·æ–°ï¼‰
2. **è¿›å…¥ä¸ªäººä¸­å¿ƒ** â†’ **ä¸ªäººä¿¡æ¯**æ ‡ç­¾é¡µ
3. **æŸ¥çœ‹å®¡æ‰¹æƒé™å­—æ®µ**ï¼Œåº”è¯¥èƒ½çœ‹åˆ° Switch å¼€å…³
4. **å°è¯•åˆ‡æ¢å¼€å…³**ï¼Œåº”è¯¥ä¸å†æŠ¥é”™

---

## ğŸ› å¦‚æœä»ç„¶æŠ¥é”™

### é”™è¯¯ 1ï¼šå­—æ®µå·²æ·»åŠ ä½†ä»ç„¶æŠ¥é”™

**å¯èƒ½åŸå› **ï¼šSupabase çš„ schema cache æœªåˆ·æ–°

**è§£å†³æ–¹æ³•**ï¼š
1. ç­‰å¾… 10-30 ç§’ååˆ·æ–°æµè§ˆå™¨
2. æˆ–è€…é‡å¯ Supabase é¡¹ç›®ï¼ˆSettings â†’ General â†’ Restart projectï¼‰

### é”™è¯¯ 2ï¼šæ‰§è¡Œ SQL æ—¶æŠ¥é”™ "column already exists"

**è¯´æ˜**ï¼šå­—æ®µå·²ç»å­˜åœ¨ï¼Œå¯èƒ½æ˜¯ cache é—®é¢˜

**è§£å†³æ–¹æ³•**ï¼š
1. ç›´æ¥æ‰§è¡Œæ­¥éª¤ 3 çš„éªŒè¯æŸ¥è¯¢
2. å¦‚æœå­—æ®µå­˜åœ¨ï¼Œç­‰å¾… cache åˆ·æ–°
3. åˆ·æ–°æµè§ˆå™¨é¡µé¢

### é”™è¯¯ 3ï¼šæƒé™é”™è¯¯

**å¯èƒ½é”™è¯¯**ï¼š`permission denied for table users`

**è§£å†³æ–¹æ³•**ï¼š
1. ç¡®ä¿åœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œï¼ˆä½¿ç”¨ admin æƒé™ï¼‰
2. æ£€æŸ¥ RLS ç­–ç•¥æ˜¯å¦å…è®¸æ“ä½œ

---

## ğŸ“ å¿«é€Ÿä¿®å¤å‘½ä»¤

å¦‚æœæ‚¨æƒ³å¿«é€Ÿä¿®å¤ï¼Œç›´æ¥å¤åˆ¶ä»¥ä¸‹å‘½ä»¤åˆ° Supabase SQL Editor æ‰§è¡Œï¼š

```sql
-- ä¸€é”®ä¿®å¤ï¼šæ·»åŠ å­—æ®µ + è®¾ç½®æƒé™ + éªŒè¯
ALTER TABLE users ADD COLUMN IF NOT EXISTS can_approve BOOLEAN DEFAULT true;
UPDATE users SET can_approve = true WHERE can_approve IS NULL;
UPDATE users SET can_approve = true WHERE email = 'test@example.com';
SELECT email, can_approve FROM users WHERE email = 'test@example.com';
```

æ‰§è¡Œåï¼Œæœ€åä¸€æ¡ SELECT åº”è¯¥æ˜¾ç¤º `can_approve = true`

---

## âœ… éªŒè¯æ¸…å•

- [ ] å·²æ‰§è¡Œæ·»åŠ å­—æ®µçš„ SQL
- [ ] éªŒè¯æŸ¥è¯¢æ˜¾ç¤ºå­—æ®µå­˜åœ¨
- [ ] å·²ç­‰å¾… 10-30 ç§’è®© cache åˆ·æ–°
- [ ] å·²åˆ·æ–°æµè§ˆå™¨é¡µé¢ï¼ˆCtrl+F5ï¼‰
- [ ] è¿›å…¥ä¸ªäººä¸­å¿ƒï¼Œèƒ½çœ‹åˆ°å®¡æ‰¹æƒé™å­—æ®µ
- [ ] èƒ½æˆåŠŸåˆ‡æ¢å¼€å…³ï¼Œä¸å†æŠ¥é”™

---

## ğŸ“ å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨

å¦‚æœæŒ‰ç…§ä»¥ä¸Šæ­¥éª¤æ“ä½œåä»ç„¶æŠ¥é”™ï¼Œè¯·æä¾›ï¼š

1. **SQL æ‰§è¡Œç»“æœæˆªå›¾**
   - æ‰§è¡ŒéªŒè¯æŸ¥è¯¢åçš„ç»“æœ

2. **é”™è¯¯ä¿¡æ¯æˆªå›¾**
   - æµè§ˆå™¨æ§åˆ¶å°çš„å®Œæ•´é”™è¯¯ä¿¡æ¯

3. **Supabase è¡¨ç»“æ„æˆªå›¾**
   - Database â†’ Tables â†’ users â†’ Columns

è¿™æ ·æˆ‘å¯ä»¥è¿›ä¸€æ­¥å¸®æ‚¨è¯Šæ–­é—®é¢˜ã€‚

