# 🚀 腾讯云部署指南

**项目名称**：YQFAIBTRIP 一起飞智能商旅系统 - DEMO  
**GitHub仓库**：https://github.com/HMC1234/-yqf-aibtrip-demo  
**部署方式**：GitHub Actions + 腾讯云COS静态网站托管

---

## 📋 部署方案选择

腾讯云提供两种主要的静态网站托管方案：

### 方案1：腾讯云COS + 静态网站托管（推荐）⭐

**优点**：
- ✅ 简单易用
- ✅ 成本低（按量付费）
- ✅ 支持CDN加速
- ✅ 配置简单

**适用场景**：静态网站、单页应用（SPA）

### 方案2：腾讯云CloudBase（云开发）

**优点**：
- ✅ 功能更全面
- ✅ 支持云函数、数据库
- ✅ 完整的开发工具链

**适用场景**：需要后端服务、数据库等

---

## 🎯 推荐方案：COS静态网站托管

本文档将重点介绍**方案1：COS静态网站托管**。

---

## 📋 准备工作

### 1. 腾讯云账号准备

1. **注册腾讯云账号**
   - 访问：https://cloud.tencent.com
   - 注册并实名认证（必需）

2. **获取API密钥**
   - 登录腾讯云控制台
   - 访问：https://console.cloud.tencent.com/cam/capi
   - 点击"新建密钥"
   - 保存 `SecretId` 和 `SecretKey`（**重要！请妥善保管**）

---

### 2. 创建COS存储桶

#### 步骤1：创建存储桶

1. **访问COS控制台**
   - 访问：https://console.cloud.tencent.com/cos
   - 点击"创建存储桶"

2. **配置存储桶**
   - **名称**：`yqf-aibtrip-demo`（可以自定义，需全局唯一）
   - **所属地域**：选择离您最近的地域（推荐：广州 `ap-guangzhou`）
   - **访问权限**：**公有读私有写**（重要！）
   - **存储类型**：标准存储
   - 其他选项保持默认

3. **点击"创建"**

#### 步骤2：开启静态网站托管

1. **进入存储桶详情**
   - 点击刚创建的存储桶名称

2. **开启静态网站托管**
   - 左侧菜单选择"基础配置" → "静态网站"
   - 点击"编辑"
   - **状态**：开启
   - **索引文档**：`index.html`
   - **错误文档**：`index.html`（SPA需要）
   - **强制HTTPS**：开启（推荐）

3. **保存配置**

#### 步骤3：配置跨域（如果需要）

1. **配置CORS**
   - 左侧菜单选择"安全设置" → "跨域访问CORS设置"
   - 点击"添加规则"
   - **来源Origin**：`*`（或指定域名）
   - **操作Methods**：`GET, HEAD, PUT, POST, DELETE`
   - **Allow-Headers**：`*`
   - **Expose-Headers**：`ETag, Content-Length`
   - **Max-Age**：`600`

---

### 3. 配置CDN加速（可选但推荐）

#### 步骤1：创建CDN加速域名

1. **访问CDN控制台**
   - 访问：https://console.cloud.tencent.com/cdn

2. **添加域名**
   - 点击"域名管理" → "添加域名"
   - **加速域名**：例如 `demo.yqf-aibtrip.com`（需要备案）
   - 或使用腾讯云提供的免费二级域名
   - **源站类型**：COS源
   - **源站地址**：选择刚创建的COS存储桶

3. **配置HTTPS**
   - 推荐开启HTTPS（可以使用腾讯云免费证书）

4. **等待部署完成**（约10-30分钟）

---

### 4. 配置GitHub Secrets

#### 步骤1：获取腾讯云API密钥

1. **访问API密钥管理**
   - 访问：https://console.cloud.tencent.com/cam/capi
   - 如果还没有密钥，点击"新建密钥"

2. **复制密钥信息**
   - `SecretId`：例如 `AKIDxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`
   - `SecretKey`：例如 `xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`

#### 步骤2：在GitHub仓库添加Secrets

1. **访问GitHub仓库**
   - 访问：https://github.com/HMC1234/-yqf-aibtrip-demo
   - 点击"Settings"（设置）

2. **添加Secrets**
   - 左侧菜单选择"Secrets and variables" → "Actions"
   - 点击"New repository secret"

3. **添加以下Secrets**：

   **Secret 1：`TENCENT_SECRET_ID`**
   - Name: `TENCENT_SECRET_ID`
   - Value: 您的腾讯云API密钥ID（从 https://console.cloud.tencent.com/cam/capi 获取）

   **Secret 2：`TENCENT_SECRET_KEY`**
   - Name: `TENCENT_SECRET_KEY`
   - Value: 您的腾讯云API密钥（从 https://console.cloud.tencent.com/cam/capi 获取）

   **⚠️ 注意：请使用您的真实密钥，不要使用示例或占位符**

   **Secret 3：`TENCENT_BUCKET`**（可选，如使用默认值）
   - Name: `TENCENT_BUCKET`
   - Value: 您的COS存储桶名称（例如：`yqf-aibtrip-demo`）

   **Secret 4：`TENCENT_REGION`**（可选，如使用默认值）
   - Name: `TENCENT_REGION`
   - Value: 您的COS地域（例如：`ap-guangzhou`）

   **Secret 5：`TENCENT_CDN_DOMAIN`**（可选，如果配置了CDN）
   - Name: `TENCENT_CDN_DOMAIN`
   - Value: 您的CDN域名（例如：`demo.yqf-aibtrip.com`）

---

## 🚀 部署步骤

### 方式1：使用GitHub Actions自动部署（推荐）⭐

#### 步骤1：配置工作流

我已经为您创建了GitHub Actions工作流文件：
- `.github/workflows/deploy-tencent.yml`（COS部署）
- `.github/workflows/deploy-tencent-cloudbase.yml`（CloudBase部署，可选）

**请根据您选择的方案使用对应的工作流文件。**

#### 步骤2：提交并推送代码

```bash
# 添加工作流文件
git add .github/workflows/

# 提交更改
git commit -m "feat: 添加腾讯云COS自动部署工作流"

# 推送到GitHub
git push origin main
```

#### 步骤3：查看部署状态

1. **访问GitHub Actions**
   - 访问：https://github.com/HMC1234/-yqf-aibtrip-demo/actions

2. **查看部署日志**
   - 点击最新的工作流运行
   - 查看构建和部署日志

3. **部署成功后**
   - 访问您的网站URL

---

### 方式2：手动部署（本地）

#### 步骤1：安装coscmd工具

```bash
# 安装pip（如果没有）
# Windows: 下载并安装Python
# Mac: brew install python3
# Linux: sudo apt-get install python3-pip

# 安装coscmd
pip install coscmd

# 或者使用pip3
pip3 install coscmd
```

#### 步骤2：配置coscmd

```bash
# 配置coscmd
coscmd config -a <SecretId> -s <SecretKey> -b <BucketName> -r <Region>

# 示例（请替换为您的实际密钥）：
coscmd config -a YOUR_SECRET_ID -s YOUR_SECRET_KEY -b yqf-aibtrip-demo -r ap-guangzhou
```

#### 步骤3：构建项目

```bash
# 安装依赖
npm install

# 构建项目
npm run build
```

#### 步骤4：上传到COS

```bash
# 上传build目录下的所有文件到COS根目录
coscmd upload -rs build/ /

# 设置index.html不缓存（SPA需要）
coscmd put build/index.html /index.html -H '{"Cache-Control":"no-cache, no-store, must-revalidate"}'
```

---

## 📋 配置说明

### GitHub Actions工作流配置

**文件**：`.github/workflows/deploy-tencent.yml`

**主要配置**：
- **触发条件**：推送到`main`分支
- **构建命令**：`npm run build`
- **输出目录**：`build`
- **部署方式**：使用coscmd上传到COS
- **认证方式**：使用GitHub Secrets中的SecretId和SecretKey

**环境变量**（在工作流中）：
- `REGION`：COS地域（默认：`ap-guangzhou`）
- `BUCKET`：COS存储桶名称（默认：`yqf-aibtrip-demo`）

---

## 🔧 常见问题

### 1. 部署失败：认证失败

**原因**：GitHub Secrets配置错误

**解决方法**：
- 检查SecretId和SecretKey是否正确
- 确保密钥有COS访问权限

### 2. 部署成功但网站无法访问

**原因**：存储桶权限配置错误

**解决方法**：
- 确保存储桶访问权限设置为"公有读私有写"
- 检查静态网站托管是否已开启

### 3. SPA路由404错误

**原因**：未配置错误文档

**解决方法**：
- 在COS控制台 → 静态网站设置中
- 将"错误文档"设置为`index.html`

### 4. CDN缓存问题

**解决方法**：
- 在COS控制台清除CDN缓存
- 或等待CDN缓存过期（默认24小时）

---

## 🌐 访问地址

### 方式1：COS默认域名（临时测试）

```
https://<BucketName>.cos-website.<Region>.myqcloud.com

示例：
https://yqf-aibtrip-demo.cos-website.ap-guangzhou.myqcloud.com
```

### 方式2：CDN加速域名（推荐）

```
https://<CDNDomain>

示例：
https://demo.yqf-aibtrip.com
```

---

## ✅ 部署检查清单

### 部署前

- [ ] 腾讯云账号已注册并实名认证
- [ ] 已创建COS存储桶
- [ ] 已开启静态网站托管
- [ ] 已配置存储桶权限（公有读私有写）
- [ ] 已获取API密钥（SecretId和SecretKey）
- [ ] 已在GitHub仓库添加Secrets
- [ ] GitHub Actions工作流文件已创建

### 部署后

- [ ] 构建成功
- [ ] 文件已上传到COS
- [ ] 网站可以正常访问
- [ ] SPA路由正常工作（无404错误）
- [ ] 静态资源加载正常

---

## 🔐 安全建议

1. **API密钥安全**
   - ✅ 永远不要在代码中硬编码密钥
   - ✅ 使用GitHub Secrets存储密钥
   - ✅ 定期轮换密钥

2. **存储桶权限**
   - ✅ 使用"公有读私有写"
   - ✅ 不要开启"公有读写"

3. **CDN配置**
   - ✅ 开启HTTPS
   - ✅ 配置防盗链（如果需要）
   - ✅ 配置访问频率限制

---

## 📝 后续维护

### 更新部署

每次代码推送到`main`分支，GitHub Actions会自动触发部署。

### 查看部署历史

1. **GitHub Actions**：https://github.com/HMC1234/-yqf-aibtrip-demo/actions
2. **COS控制台**：查看文件列表和访问日志

### 回滚部署

如果需要回滚到之前的版本：

1. **Git方式**（推荐）：
   ```bash
   git checkout <previous-commit-hash>
   git push origin main
   ```

2. **手动上传**：
   - 构建之前的版本
   - 手动上传到COS

---

## 📞 支持

如有问题，请参考：
- **腾讯云COS文档**：https://cloud.tencent.com/document/product/436
- **GitHub Actions文档**：https://docs.github.com/en/actions

---

**配置完成后，每次推送到`main`分支都会自动部署到腾讯云！** 🚀

